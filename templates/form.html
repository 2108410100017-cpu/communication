<!DOCTYPE html>
<html>
<head>
    <title>Product Sender</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { color: #333; }
        label { display: inline-block; width: 100px; }
        input, select { margin-bottom: 10px; }
        pre {
            background: #f5f5f5;
            border: 1px solid #ccc;
            padding: 10px;
            max-height: 400px;
            overflow: auto;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>Send Product Info</h1>

    {% if error %}
    <p style="color:red;">{{ error }}</p>
    {% endif %}

    {% if success %}
    <p style="color:green;">{{ success }}</p>
    {% endif %}

    <form id="productForm" action="/send" method="post" enctype="multipart/form-data">
        <label>Model:</label>
        <select name="model">
            {% for m in models %}
            <option value="{{ m }}">{{ m }}</option>
            {% endfor %}
        </select><br>

        <label>Brand:</label>
        <select name="brand">
            {% for b in brands %}
            <option value="{{ b }}">{{ b }}</option>
            {% endfor %}
        </select><br>

        <label>Length:</label>
        <input type="text" name="length" required><br>

        <label>Width:</label>
        <input type="text" name="width" required><br>

        <label>Height:</label>
        <input type="text" name="height" required><br>

        <label>Upload Folder:</label>
        <input id="folderInput" type="file" name="folder" webkitdirectory multiple>
        <br><br>

        <input type="submit" value="Send Product Info">
    </form>

    <h3>JSON Preview:</h3>
    <pre id="jsonPreview">Select a folder to preview its JSON structure...</pre>

    {% if sent_data %}
<h3>Sent JSON</h3>
<pre style="background:#111; color:#0f0; padding:10px; border-radius:10px;">{{ sent_data }}</pre>
{% endif %}


    {% if folder_info %}
        <h3>Uploaded Folder Info:</h3>
        <p>Folder Name: {{ folder_info.folder_name }}</p>
        <ul>
        {% for f in folder_info.files %}
            <li>{{ f }}</li>
        {% endfor %}
        </ul>
    {% endif %}

    <script>
        const folderInput = document.getElementById('folderInput');
        const jsonPreview = document.getElementById('jsonPreview');

        folderInput.addEventListener('change', (event) => {
            const files = event.target.files;
            if (!files.length) return;

            let folderMap = {};
            let rootFolder = files[0].webkitRelativePath.split('/')[0] || "UploadedFolder";

            Array.from(files).forEach(f => {
                const pathParts = f.webkitRelativePath.split('/');
                const fileName = pathParts.pop();
                const folderPath = pathParts.slice(1).join('/'); // remove root folder name

                if (!folderMap[folderPath]) folderMap[folderPath] = [];
                folderMap[folderPath].push(fileName);
            });

            const jsonData = {
                "Model": document.querySelector('select[name="model"]').value,
                "Brand": document.querySelector('select[name="brand"]').value,
                "Size": {
                    "Length": document.querySelector('input[name="length"]').value || "N/A",
                    "Width": document.querySelector('input[name="width"]').value || "N/A",
                    "Height": document.querySelector('input[name="height"]').value || "N/A"
                },
                "FolderData": {
                    "folder_name": rootFolder,
                    "files": folderMap
                }
            };

            jsonPreview.textContent = JSON.stringify(jsonData, null, 4);
        });
    </script>
</body>
</html>
