<!DOCTYPE html>
<html>
<head>
    <title>Product Sender</title>
    <style>
        body {
            font-family: "Segoe UI", Roboto, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f3f4f6;
            color: #333;
        }

        .container {
            max-width: 700px;
            margin: 40px auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 30px 40px;
        }

        h1 {
            text-align: center;
            color: #1f2937;
            margin-bottom: 25px;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        label {
            font-weight: 500;
            margin-bottom: 5px;
        }

        input[type="text"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 15px;
            transition: border-color 0.2s;
        }

        input[type="text"]:focus, select:focus {
            border-color: #2563eb;
            outline: none;
        }

        input[type="file"] {
            border: 1px dashed #9ca3af;
            border-radius: 8px;
            padding: 10px;
            background: #f9fafb;
        }

        input[type="submit"] {
            background-color: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 18px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.25s ease;
        }

        input[type="submit"]:hover {
            background-color: #1d4ed8;
        }

        .message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .error {
            background: #fee2e2;
            color: #b91c1c;
            border: 1px solid #fecaca;
        }

        .success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        h3 {
            margin-top: 25px;
            color: #1e293b;
        }

        pre {
            background: #1e1e1e;
            color: #0f0;
            border-radius: 8px;
            padding: 12px;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.5;
        }

        #jsonPreview {
            background: #f9fafb;
            color: #111;
            border: 1px solid #e5e7eb;
            padding: 12px;
        }

        ul {
            background: #f9fafb;
            padding: 10px 20px;
            border-radius: 8px;
        }

        footer {
            text-align: center;
            margin-top: 30px;
            font-size: 13px;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“¦ Product Sender</h1>

        {% if error %}
        <div class="message error">{{ error }}</div>
        {% endif %}

        {% if success %}
        <div class="message success">Message successfully sent!</div>
        {% endif %}

        <form id="productForm" action="/send" method="post" enctype="multipart/form-data">
            <div>
                <label>Model:</label>
                <select name="model" required>
                    {% for m in models %}
                    <option value="{{ m }}">{{ m }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <label>Brand:</label>
                <select name="brand" required>
                    {% for b in brands %}
                    <option value="{{ b }}">{{ b }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <label>Length:</label>
                <input type="text" name="length" required>
            </div>

            <div>
                <label>Width:</label>
                <input type="text" name="width" required>
            </div>

            <div>
                <label>Height:</label>
                <input type="text" name="height" required>
            </div>

            <div>
                <label>Upload Folder:</label>
                <input id="folderInput" type="file" name="folder" webkitdirectory multiple>
            </div>

            <input type="submit" value="Send Product Info">
        </form>

        <h3>JSON Preview:</h3>
        <pre id="jsonPreview">Select a folder to preview its JSON structure...</pre>

        {% if sent_data %}
        <h3>Sent JSON</h3>
        <pre>{{ sent_data }}</pre>
        {% endif %}

        {% if folder_info %}
        <h3>Uploaded Folder Info:</h3>
        <p><b>Folder Name:</b> {{ folder_info.folder_name }}</p>
        <ul>
            {% for f in folder_info.files %}
            <li>{{ f }}</li>
            {% endfor %}
        </ul>
        {% endif %}
    </div>

    <footer>Â© 2025 Product Sender Interface</footer>

    <script>
        const folderInput = document.getElementById('folderInput');
        const jsonPreview = document.getElementById('jsonPreview');

        folderInput.addEventListener('change', (event) => {
            const files = event.target.files;
            if (!files.length) return;

            let folderMap = {};
            let rootFolder = files[0].webkitRelativePath.split('/')[0] || "UploadedFolder";

            Array.from(files).forEach(f => {
                const pathParts = f.webkitRelativePath.split('/');
                const fileName = pathParts.pop();
                const folderPath = pathParts.slice(1).join('/'); // remove root folder name

                if (!folderMap[folderPath]) folderMap[folderPath] = [];
                folderMap[folderPath].push(fileName);
            });

            const jsonData = {
                "Model": document.querySelector('select[name="model"]').value,
                "Brand": document.querySelector('select[name="brand"]').value,
                "Size": {
                    "Length": document.querySelector('input[name="length"]').value || "N/A",
                    "Width": document.querySelector('input[name="width"]').value || "N/A",
                    "Height": document.querySelector('input[name="height"]').value || "N/A"
                },
                "FolderData": {
                    "folder_name": rootFolder,
                    "files": folderMap
                }
            };

            jsonPreview.textContent = JSON.stringify(jsonData, null, 4);
        });
    </script>
</body>
</html>
